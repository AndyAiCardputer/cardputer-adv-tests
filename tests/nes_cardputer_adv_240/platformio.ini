; PlatformIO Project Configuration File
; NES Emulator - External Display ILI9341 (2.4")
; Single-core, external ILI9341 display (240x320, 2.4"), minimal setup

; ========================================
; Environment WITHOUT external display (for SD card testing)
; ========================================
[env:m5stack-cardputer-adv-sdonly]
platform = espressif32
board = m5stack-stamps3
framework = arduino

; ✅ Exclude external display and OSD files from build
src_filter = +<main.cpp> +<pins.h> -<external_display/*> -<nes_osd.cpp>

build_flags = 
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCORE_DEBUG_LEVEL=3
    -O2
    -Wall
    -DDEBUG=1
    -DHW_AUDIO_SAMPLERATE=22050
    -DNTSC
    -UNOFRENDO_DEBUG
    -UNOFRENDO_MEM_DEBUG
    ; NO -DUSE_EXTERNAL_DISPLAY!
    ; Include paths
    -Isrc
    ; NO -Isrc/external_display (not needed for SD-only test)
    -Ilib/arduino-nofrendo/src
    -Ilib/arduino-nofrendo/src/nes
    -Ilib/arduino-nofrendo/src/mappers
    -Ilib/arduino-nofrendo/src/sndhrdw
    -Ilib/arduino-nofrendo/src/cpu
    -Ilib/arduino-nofrendo/src/libsnss

monitor_speed = 115200
monitor_filters = esp32_exception_decoder
upload_speed = 921600

lib_deps = 
    m5stack/M5Cardputer@^1.0.3
    ; NO m5stack/M5GFX@^0.2.17 (not needed for SD-only test)
    sd
    spi

board_build.partitions = huge_app.csv
board_build.flash_mode = qio
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.arduino.memory_type = qio_opi

; ========================================
; Environment WITH external display (for main project)
; ========================================
[env:m5stack-cardputer-adv-ext]
platform = espressif32
board = m5stack-stamps3
framework = arduino

; ✅ Include external display and OSD files in build
src_filter = +<main.cpp> +<nes_osd.cpp> +<external_display/*> +<pins.h>

build_flags = 
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCORE_DEBUG_LEVEL=3
    -O2
    -Wall
    -DDEBUG=1
    -DHW_AUDIO_SAMPLERATE=22050
    -DNTSC
    -UNOFRENDO_DEBUG
    -UNOFRENDO_MEM_DEBUG
    -DUSE_EXTERNAL_DISPLAY  ; ✅ Flag to enable external display
    ; Include paths
    -Isrc
    -Isrc/external_display
    -Ilib/arduino-nofrendo/src
    -Ilib/arduino-nofrendo/src/nes
    -Ilib/arduino-nofrendo/src/mappers
    -Ilib/arduino-nofrendo/src/sndhrdw
    -Ilib/arduino-nofrendo/src/cpu
    -Ilib/arduino-nofrendo/src/libsnss

monitor_speed = 115200
monitor_filters = esp32_exception_decoder
upload_speed = 921600

lib_deps = 
    m5stack/M5Cardputer@^1.0.3
    m5stack/M5GFX@^0.2.17
    sd
    spi

board_build.partitions = huge_app.csv
board_build.flash_mode = qio
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.arduino.memory_type = qio_opi
